<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>DUC DZ - Key Generator</title>
  <style>
    body { font-family: monospace; text-align:center; margin-top:50px; background:#111; color:#0f0; }
    h1 { color:#ff0; }
    .box { border:1px solid #0f0; padding:20px; margin:auto; width:400px; border-radius:10px; }
    #key { font-size: 18px; color: #0ff; margin-top: 10px; }
  </style>
</head>
<body>
  <h1>üîë DUC DZ - Key Generator üîë</h1>
  <div class="box">
    <p id="status">ƒêang t·∫°o key m·ªõi...</p>
    <p id="key"></p>
  </div>

  <script>
    async function generateKey() {
      // random key d·∫°ng DUC_123xxx
      const rand = Math.random().toString(36).substring(2, 8);
      const key = "DUC_123" + rand;

      const repo = "DucDarling/bio";     // repo th·∫≠t
      const path = "key_thuong.json";    // file ch·ª©a keys
      const apiUrl = `https://api.github.com/repos/${repo}/contents/${path}`;

      // ‚ö†Ô∏è D√°n token GitHub v√†o ƒë√¢y (PAT c√≥ Contents: Read+Write)
      const token = "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";

      try {
        // l·∫•y file key_thuong.json
        const res = await fetch(apiUrl, {
          headers: { "Authorization": "token " + token }
        });

        let json = { keys: [] };
        let sha = null;

        if (res.status === 200) {
          const data = await res.json();
          sha = data.sha;
          if (data.content) {
            let content = atob(data.content.replace(/\n/g, ""));
            json = JSON.parse(content);
          }
        } else if (res.status === 404) {
          json = { keys: [] };
          sha = null;
        } else {
          throw new Error("GitHub API l·ªói (status " + res.status + ")");
        }

        // th√™m key m·ªõi
        json.keys.push(key);

        // ghi l·∫°i file tr√™n GitHub
        const update = await fetch(apiUrl, {
          method: "PUT",
          headers: {
            "Authorization": "token " + token,
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            message: "Add new key",
            content: btoa(JSON.stringify(json, null, 2)),
            sha: sha
          })
        });

        if (update.ok) {
          document.getElementById("status").innerText = "‚úÖ Key c·ªßa b·∫°n:";
          document.getElementById("key").innerText = key;
        } else {
          document.getElementById("status").innerText = "‚ùå L·ªói khi ghi key l√™n server!";
        }
      } catch (e) {
        document.getElementById("status").innerText = "‚ùå L·ªói: " + e;
      }
    }

    generateKey();
  </script>
</body>
</html>
