<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>DUC DZ - Key Generator</title>
  <style>
    body { background:#111; color:#0f0; font-family: monospace; text-align:center; padding:50px; }
    h1 { color:#ff0; }
    #keyBox { font-size:20px; margin-top:20px; color:#0ff; }
    #status { margin-top:15px; }
  </style>
</head>
<body>
  <h1>üîë DUC DZ - Key Generator</h1>
  <p id="status">ƒêang t·∫°o key m·ªõi...</p>
  <div id="keyBox"></div>

  <script>
    const repo = "DucDarling/bio";   // repo public
    const path = "key_thuong.json";
    const apiUrl = `https://api.github.com/repos/${repo}/contents/${path}`;
    const token = "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";

    async function generateKey() {
      const newKey = "DUC_" + Math.random().toString(36).substring(2, 10).toUpperCase();

      try {
        // L·∫•y file key_thuong.json hi·ªán t·∫°i
        const res = await fetch(apiUrl, {
          headers: { Authorization: `Bearer ${token}` }
        });

        if (!res.ok) {
          document.getElementById("status").innerText = "‚ùå L·ªói GET: " + res.status;
          return;
        }

        const data = await res.json();
        let content = {};
        let sha = null;

        try {
          content = JSON.parse(atob(data.content));
          sha = data.sha;
        } catch (e) {
          content = { keys: [] };
        }

        // Th√™m key m·ªõi
        if (!content.keys) content.keys = [];
        content.keys.push(newKey);

        // Encode l·∫°i sang base64
        const updatedContent = btoa(JSON.stringify(content, null, 2));

        // Update file tr√™n GitHub
        const updateRes = await fetch(apiUrl, {
          method: "PUT",
          headers: {
            Authorization: `Bearer ${token}`,
            Accept: "application/vnd.github.v3+json"
          },
          body: JSON.stringify({
            message: `Add new key: ${newKey}`,
            content: updatedContent,
            sha: sha
          })
        });

        if (!updateRes.ok) {
          document.getElementById("status").innerText = "‚ùå L·ªói PUT: " + updateRes.status;
          return;
        }

        document.getElementById("status").innerText = "‚úÖ Key ƒë√£ ƒë∆∞·ª£c t·∫°o th√†nh c√¥ng!";
        document.getElementById("keyBox").innerText = newKey;
      } catch (err) {
        document.getElementById("status").innerText = "‚ùå L·ªói: " + err.message;
      }
    }

    generateKey();
  </script>
</body>
</html>
