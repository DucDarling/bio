<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Bio Page</title>
</head>
<body>
  <h2>Ch√†o m·ª´ng b·∫°n!</h2>
  <p>B·∫°n ƒë√£ v∆∞·ª£t link th√†nh c√¥ng üéâ</p>
  <div id="key"></div>

  <script>
    async function main() {
      const params = new URLSearchParams(window.location.search);
      const sid = params.get("sid");
      if (!sid) return;

      // T·∫°o key d·∫°ng DUC_sid
      const newKey = "DUC_" + sid;
      document.getElementById("key").innerText = "üîë Key c·ªßa b·∫°n: " + newKey;

      // ==== CONFIG ====
      const GIST_ID = "bcacd8810c48a5788e0bba0cdb428aac";
      const GIST_FILE = "key.json";
      const GITHUB_TOKEN = "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"; // ‚ö†Ô∏è token th·∫≠t c·ªßa b·∫°n

      // L·∫•y key.json hi·ªán t·∫°i
      const resp = await fetch(`https://gist.githubusercontent.com/ducdzvcl123/${GIST_ID}/raw/${GIST_FILE}`);
      let data = [];
      try {
        data = await resp.json();
      } catch (e) {
        console.log("Ch∆∞a c√≥ key.json ho·∫∑c l·ªói parse JSON");
      }

      // N·∫øu ch∆∞a c√≥ th√¨ th√™m key
      if (!data.includes(newKey)) {
        data.push(newKey);

        // C·∫≠p nh·∫≠t l√™n Gist qua API
        await fetch(`https://api.github.com/gists/${GIST_ID}`, {
          method: "PATCH",
          headers: {
            "Authorization": "token " + GITHUB_TOKEN,
            "Accept": "application/vnd.github.v3+json"
          },
          body: JSON.stringify({
            files: {
              [GIST_FILE]: {
                content: JSON.stringify(data, null, 2)
              }
            }
          })
        });
      }
    }
    main();
  </script>
</body>
</html>
