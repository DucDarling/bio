<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>DUC DZ - Key Generator</title>
  <style>
    body { font-family: monospace; text-align:center; margin-top:50px; background:#111; color:#0f0; }
    h1 { color:#ff0; }
    .box { border:1px solid #0f0; padding:20px; margin:auto; width:400px; border-radius:10px; }
  </style>
</head>
<body>
  <h1>üîë DUC DZ - Key Generator üîë</h1>
  <div class="box">
    <p id="status">ƒêang t·∫°o key m·ªõi...</p>
  </div>

  <script>
    async function generateKey() {
      // random key d·∫°ng DUC_123xxx
      const rand = Math.random().toString(36).substring(2, 8);
      const key = "DUC_123" + rand;

      // repo + file json
      const repo = "DucDarling/bio";     // ƒë·ªïi th√†nh repo th·∫≠t c·ªßa √¥ng
      const path = "key_thuong.json";    // file ch·ª©a keys
      const apiUrl = `https://api.github.com/repos/${repo}/contents/${path}`;

      // ‚ö†Ô∏è Thay token n√†y b·∫±ng token th·∫≠t (PAT c√≥ quy·ªÅn Contents: Read+Write)
      const token = "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";

      try {
        // l·∫•y file hi·ªán t·∫°i
        const res = await fetch(apiUrl, {
          headers: { "Authorization": "token " + token }
        });
        if (!res.ok && res.status !== 404) {
          throw new Error("Kh√¥ng l·∫•y ƒë∆∞·ª£c file key_thuong.json t·ª´ GitHub");
        }
        let json = { keys: [] };
        let sha = null;

        if (res.status === 200) {
          const data = await res.json();
          sha = data.sha;
          if (data.content) {
            let content = atob(data.content.replace(/\n/g, ""));
            json = JSON.parse(content);
          }
        }

        // th√™m key m·ªõi
        json.keys.push(key);

        // commit l·∫°i file
        const update = await fetch(apiUrl, {
          method: "PUT",
          headers: {
            "Authorization": "token " + token,
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            message: "Add new key",
            content: btoa(JSON.stringify(json, null, 2)),
            sha: sha
          })
        });

        if (update.ok) {
          document.getElementById("status").innerText = "‚úÖ Key c·ªßa b·∫°n: " + key;
        } else {
          document.getElementById("status").innerText = "‚ùå L·ªói khi ghi key l√™n server!";
        }
      } catch (e) {
        document.getElementById("status").innerText = "‚ùå L·ªói: " + e;
      }
    }

    generateKey();
  </script>
</body>
</html>
